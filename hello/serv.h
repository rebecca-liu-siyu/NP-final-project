#ifndef SERV_H
#define SERV_H
# include <stdbool.h>
#include <netinet/tcp.h>

// Extra definitions
# define MAIN_START printf("\n= MAIN START =\n")
# define MAIN_END printf("\n= MAIN END =\n")
# define MAXCLIENT  100
# define USER_FILE  "users.txt"
# define TP_FILE    "tp.txt"

// structures
struct Room {
    char*  owner;
    int    roomid;
    int    capacity;
    char** players;
    bool   ownerStatus;
    bool   isPublic;
    
    int    onlineCount;
    bool*  onlineStatus;
    int*   Connfds;

    bool   gameStart;
    bool   gameEnd;
};
typedef struct Room Room_t;

// Global variables
int listen_fd;
Room_t* Rooms;
int RoomCount;
int RandomRoomID[] = {1539,1710,429,2856,419,523,793,799,1158,540,1305,72,1241,154,216,458,857,2462,1937,1199,749,2358,910,339,1852,305,1884,2078,2722,484,131,2510,2050,1975,1447,887,1470,654,2031,1531,2191,1255,1923,507,1920,963,1089,2934,956,226,2783,834,2710,1731,2115,16,981,80,1992,1162,2135,1093,657,334,1067,1968,33,2383,347,1623,186,2086,167,194,256,1910,1347,2309,1454,219,1915,1826,1643,2480,2148,1511,594,2672,264,1577,615,1702,2806,68,1376,2311,337,948,2440,312,2642,832,804,498,34,263,44,2468,1212,285,2903,1466,233,2872,304,172,2126,97,2956,2014,290,1001,1792,409,397,1649,1473,1176,1402,28,119,922,2457,2790,1408,1460,1248,24,2566,1800,2391,2495,1038,1133,2988,1429,524,2516,2212,374,2355,1646,1840,1140,2840,756,2735,1052,475,56,1273,1265,2505,1104,1209,1934,533,667,2352,972,2579,1385,1769,1544,2300,897,383,152,1536,1886,1604,2725,529,1173,503,326,1594,1141,1203,401,2730,430,1458,342,1903,983,2819,2166,721,451,1606,1703,198,2071,1494,1105,32,746,160,2520,2204,228,1503,1742,1092,1056,400,660,384,2465,1260,1327,1312,1174,641,2831,2017,1798,1516,977,390,511,537,2074,1525,1944,75,2357,162,348,2053,170,2150,1585,2386,867,935,2280,1426,1562,635,1806,445,55,1474,2816,1990,707,450,1279,2723,192,111,184,2917,1653,2008,447,743,2040,2878,2547,2415,2511,473,1074,1921,2890,1198,1044,45,2197,779,1620,2187,1537,173,595,1036,177,2871,982,2110,1128,1851,2346,2454,1652,2041,666,1400,2853,2998,1908,1032,2388,1641,773,2325,2521,1374,2788,168,2060,798,852,1759,957,1358,2889,464,1696,728,1913,737,813,1435,127,1842,1307,830,987,1111,2567,1682,1308,2198,2163,1670,2946,223,1509,777,1465,2739,2279,1894,1190,854,1107,504,1319,2287,158,2211,2611,739,252,2007,1490,531,2548,786,371,1906,2885,2798,245,1172,2256,2139,61,1219,546,1166,1732,1229,1225,50,1545,37,1640,2868,2102,929,2329,1344,2165,1331,1365,1930,432,1240,423,1467,607,1965,1274,431,2122,1588,760,1898,1953,2320,1779,1040,143,1940,1015,2205,2573,1444,1071,35,801,301,2189,1023,1727,617,816,1136,1177,2083,1456,2769,1762,89,2161,1072,817,2327,2267,1645,688,2221,2236,2301,712,863,1420,442,2306,2803,1302,113,1870,1845,2674,720,622,1502,2883,2057,1773,234,27,761,1659,2250,2403,2450,358,2810,373,181,2874,2587,1496,2207,1124,980,182,136,379,57,2685,1150,668,1442,4,846,1009,1252,1183,2755,1858,2836,1170,606,103,23,1763,1662,1514,847,2588,1651,550,2485,341,468,121,2562,128,52,1446,2434,422,2602,1853,2447,1862,2123,1629,1611,2886,672,564,2088,1745,1079,2242,2230,888,2170,1351,823,2624,1897,625,1830,1690,3000,608,413,1752,2478,2237,1756,1184,734,2096,2656,1956,2595,1767,2328,1330,1621,2168,307,2747,1450,2743,1096,319,1878,1270,1155,2241,631,2292,542,2607,1547,1692,1430,1253,362,1148,2282,1233,2517,2795,303,522,1151,1369,598,2438,1875,1443,196,2422,881,1618,1293,356,2748,2862,2172,1567,1438,2146,970,2058,1828,2206,2401,1171,2037,1961,2157,1284,2937,2568,939,317,18,1973,1413,2954,185,1186,738,2770,2302,1364,1513,947,2629,2926,483,190,1790,2933,1065,1013,2504,2621,1569,754,132,1007,1379,1247,1482,2797,1357,1180,2429,2741,2338,1560,2817,2464,1008,2634,157,106,2950,1524,2859,2408,243,2664,945,2852,1059,1359,372,2659,2093,633,2668,1014,2949,1090,2104,2966,2636,2196,343,2690,2273,515,2331,692,2558,2137,1138,2443,1850,725,1205,2248,402,2043,2472,809,59,2682,2691,1715,62,1628,2360,745,848,744,2377,1152,1353,539,2275,2991,1031,60,1230,169,139,1115,1868,2404,1297,10,1134,267,404,1320,1404,2557,2227,1501,1786,20,2184,2943,2844,704,2626,1455,444,94,2179,2365,1783,1777,2936,2138,1245,1415,1655,2143,165,682,1113,818,188,2704,2791,766,907,2208,487,461,2935,249,297,2929,361,2679,1984,1928,1656,1178,661,2489,548,2924,2406,1563,815,784,1085,2183,417,1803,1201,2430,2544,1815,2356,1047,1931,1337,2733,479,2407,976,459,2027,2336,1321,1730,1238,2695,2716,1,2437,1387,2499,2951,630,729,77,189,1277,2904,2099,286,388,2746,1102,943,2632,393,436,2411,1121,723,986,2470,122,47,2131,1891,2760,1226,2394,770,2771,1722,2864,2513,2583,2276,2657,563,2869,2364,1861,147,1812,67,2106,819,313,1422,1825,308,370,1634,557,2820,1854,1181,2574,1135,916,2539,1735,2892,195,1667,2427,2313,690,351,1542,175,380,2974,109,406,2257,1663,1841,669,1672,1770,1918,1453,1231,1469,1962,1679,2185,940,1758,1810,603,2663,2387,466,2259,2305,2015,521,2689,1789,1131,1028,2684,632,645,2851,650,2556,6,1935,518,1208,2536,1417,203,1299,240,2215,2809,1666,449,2271,2638,2068,353,114,1452,545,1393,2080,1108,81,1846,476,1058,2324,310,2290,1827,2111,1020,1433,1398,709,2363,1751,2995,787,2586,1678,13,1097,2225,471,2905,2193,2373,2914,2507,718,2013,2064,771,1149,135,1026,1160,1517,151,2022,1947,2195,2594,646,1168,2069,1697,2976,2188,908,2446,250,40,2428,1276,2039,1597,2821,1615,1911,1431,796,790,1169,360,2092,1642};

// Functions
void  userfile_setup(); // initial status: off
void  rooms_setup();    // initial rooms status
void  room_print(Room_t* room);
void  cli_disconnect(int connfd);
void* handle_client(void* connfd_ptr);
int register_user(int connfd, const char* username, const char* passwd);
int login_user(int connect_fd, const char* username, const char* password);
void Lobby(int connfd, const char* username);
int NewRoom(int connfd, const char* username);
int JoinRoom(int connfd, const char* username);
void HandleRoom(int connfd, int roomID, const char* username);
void RunGame(int roomID, Room_t* room, const char* username);
int Game6(int roomID, Room_t* room);
void broadcastMSG(Room_t* room, const char* sendline);
int Game6_EndCheck(int* charactor, bool* alive);
#endif // SERV_H